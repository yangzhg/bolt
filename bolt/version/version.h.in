/*
 * Copyright (c) ByteDance Ltd. and/or its affiliates
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#pragma once

#include <string>
#include <sstream>
#include <iomanip> 
namespace bytedance::bolt {

enum class SparkVersion : int8_t {
  UNDEFINED,
  SPARK_3_2,
  SPARK_3_3,
  SPARK_3_4,
  SPARK_3_5
};

constexpr const SparkVersion kSparkVersion = SparkVersion::@BOLT_SPARK_VERSION@;

struct BuildInfo {
  static constexpr const char* version = "@BOLT_BUILD_SHORT_HASH@";
  static constexpr const char* hash = "@BOLT_BUILD_HASH@";
  static constexpr const char* shortHash = "@BOLT_BUILD_SHORT_HASH@";
  static constexpr const char* time = "@BOLT_BUILD_TIME@";
  static constexpr const char* host = "@BOLT_BUILD_HOST@";
  static constexpr const char* systemName = "@BOLT_BUILD_SYSTEM_NAME@";
  static constexpr const char* processor = "@BOLT_BUILD_PROCESSOR@";
  static constexpr const char* buildType = "@BOLT_BUILD_TYPE@";
  static constexpr const char* architecture = "@BOLT_BUILD_ARCH@";
  static constexpr bool isDirty = @BOLT_BUILD_DIRTY@;
  static constexpr const char* modifiedFiles = "@BOLT_MODIFIED_FILES@";

  inline static std::string toString(bool full = false) {
    std::string versionInfo = "========================================\n";
    versionInfo += "          Bolt Build Information        \n";
    versionInfo += "========================================\n";

    versionInfo += "Bolt Version     : " + std::string(version) + "\n";
    versionInfo += "Git Commit ID    : " + std::string(hash) + "\n";
    versionInfo += "Build Type       : " + std::string(buildType) + "\n";
    versionInfo += "Build Time       : " + std::string(time) + "\n";

    if (isDirty) {
      versionInfo += "Dirty Build      : true\n";
      versionInfo += "Modified Files   : " + std::string(modifiedFiles) + "\n";
    } else {
      versionInfo += "Dirty Build      : false\n";
    }

    if (full) {
      versionInfo += "Host Name        : " + std::string(host) + "\n";
      versionInfo += "OS Name          : " + std::string(systemName) + "\n";
      versionInfo += "Architecture     : " + std::string(architecture) + "\n";
      versionInfo += "Build Processor  : " + std::string(processor) + "\n";
    }

    versionInfo += "========================================\n";
    return versionInfo;
  }
  inline static std::string toJson(bool full = false) {
    std::ostringstream oss;
    oss << std::boolalpha;
    oss << "{\n";
    oss << "  \"version\": \"" << version << "\",\n";
    oss << "  \"hash\": \"" << hash << "\",\n";
    oss << "  \"shortHash\": \"" << shortHash << "\",\n";
    oss << "  \"time\": \"" << time << "\",\n";
    oss << "  \"isDirty\": " << isDirty << ",\n";
    if (isDirty) {
      oss << "  \"modifiedFiles\": \"" << modifiedFiles << "\",\n";
    }
    if (full) {
      oss << "  \"host\": \"" << host << "\",\n";
      oss << "  \"systemName\": \"" << systemName << "\",\n";
      oss << "  \"architecture\": \"" << architecture << "\",\n";
      oss << "  \"processor\": \"" << processor << "\",\n";
    }
    oss << "  \"buildType\": \"" << buildType << "\"\n";
    oss << "}";
    return oss.str();
  }
};
inline std::string BoltVersion(bool full = false) {
  return BuildInfo::toString(full);
}

} // namespace bytedance::bolt
